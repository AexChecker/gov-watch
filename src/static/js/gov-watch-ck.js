// Generated by IcedCoffeeScript 1.2.0s
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=[].slice;k={Deferrals:function(){function a(a){this.continuation=a;this.count=1;this.ret=null}a.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)};a.prototype.defer=function(a){var b=this;++this.count;return function(){var c,d;c=1<=arguments.length?M.call(arguments,0):[];a!=null&&(d=a.assign_fn)!=null&&d.apply(null,c);return b._fulfill()}};return a}(),findDeferral:function(){return null}};L=function(){};o=null;d=[];f=[];e=[];u="";s="";v="";F=!1;a="b";c="s";b="t";H=null;G=function(a){var b,c,d,e,f,g;d="";if(a==="")return"";for(e=f=0,g=a.length-1;0<=g?f<=g:f>=g;e=0<=g?++f:--f){b=a.charAt(e);c=a.charCodeAt(e);c>=1488&&c<1536&&(c-=1360);c<256&&(d+=(c+256).toString(16).substr(-2).toUpperCase())}return d};I=function(a){var b,c,d,e,f;c="";if(a==="")return"";for(d=e=0,f=a.length/2-1;0<=f?e<=f:e>=f;d=0<=f?++e:--e){b=a.slice(d*2,d*2+1+1||9e9);b=parseInt(b,16);b>=128&&(b+=1360);c+=String.fromCharCode(b)}return c};i=function(d,e,f){return f?"!z="+a+":"+G(d)+"_"+c+":"+f:"!z="+a+":"+G(d)+"_"+b+":"+G(e)};j=function(a){return"http://"+window.location.host+"/#"+i(u,"",a)};J=function(a){var b,c,d,e=this;d=L;b=k.findDeferral(arguments);(function(a){c=new k.Deferrals(a,{parent:b,filename:"gov-watch.iced",funcname:"update_history"});setTimeout(c.defer({assign_fn:function(){return function(){return c.ret=arguments[0]}}(),lineno:56}),0);c._fulfill()})(function(){return window.location.hash=i(u,s,a)})};w=function(a){return $("title").html(a)};p=function(){var e,f,g,i,j,k,l,m,n,o;e=window.location.hash;f=e.slice(4,e.length);k=f.split("_");j=null;u=null;s="";for(m=0,n=k.length;m<n;m++){i=k[m];o=i.split(":"),g=o[0],l=o[1];g===a&&(u=I(l));g===c&&(j=l);g===b&&(s=I(l))}if(!u&&!j){u=d[0];J();return}$("#books li.book").toggleClass("active",!1);$("#books li.book[data-book='"+u+"']").toggleClass("active",!0);if(s!==""){E(!1);$("#searchbox").val(s)}if(j){v=j;t(v);$(".item").removeClass("shown");$("#items").isotope({filter:".shown"})}else{w('דו"ח טרכטנברג | המפקח: מעקב אחר ישום המלצות הועדה');v=null;t(null);h()}return _gaq.push(["_trackPageview","/"+e])};K=!1;E=function(a){a?$("#searchbox").val("סינון חופשי של ההמלצות"):K&&$("#searchbox").val("");K=a;return $("#searchbox").toggleClass("watermark",a)};g=function(a){var b,c,g,h,i,j,k,l,m,n,p,r,s,t,u,v,w,x,y,z,A,B;o=a;d={};f={};e={};for(n=0,t=a.length;n<t;n++){i=a[n];h={};d[i.base.book]||(d[i.base.book]={});d[i.base.book][i.base.chapter]=!0;x=i.base.tags;for(p=0,u=x.length;p<u;p++){j=x[p];f[j]=1}e[i.base.subject]=1;b=[];m=[];y=i.updates;for(c in y){l=y[c];for(r=0,v=l.length;r<v;r++){k=l[r];k.user=c;c==="gov"?b.push(k):m.push(k);if(k.links){z=k.links;for(s=0,w=z.length;s<w;s++){g=z[s];h[g.url]=!0}}}}i.base.num_links=Object.keys(h).length;i.gov_updates=b;i.watch_updates=m;i.base.subscribers=(A=i.subscribers)!=null?A:0;((B=i.base.recommendation)!=null?B.length:void 0)>500?i.base.recommendation_shortened=i.base.recommendation.slice(0,501)+"&nbsp;"+("<a class='goto-detail' rel='"+i.slug+"' href='#'>")+"עוד..."+"</a>":i.base.recommendation_shortened=i.base.recommendation}f=Object.keys(f);e=Object.keys(e);d=Object.keys(d);if(localStorage){localStorage.data=JSON.stringify(a);localStorage.all_books=JSON.stringify(d);localStorage.all_tags=JSON.stringify(f);localStorage.all_subjects=JSON.stringify(e)}return q()};l=!1;y=function(){var a,b,c,d,g,h,i;E(!0);$("#searchbox").change(function(){K?s="":s=$("#searchbox").val();return J()});$("#searchbox").focus(function(){return E(!1)});$("#searchbox").blur(function(){if($(this).val()==="")return E(!0)});$("#searchbar").submit(function(){return!1});a=[];for(d=0,h=f.length;d<h;d++){c=f[d];a.push({type:"tag",title:c})}for(g=0,i=e.length;g<i;g++){b=e[g];a.push({type:"subject",title:b})}$("#searchbox").typeahead({source:a,items:20,matcher:function(a){return~a.title.indexOf(this.query)},valueof:function(a){return a.title},itemfrom:function(a){return{type:"subject",title:a}},selected:function(a){s=a;return J()},highlighter:function(a){var b;b=a.title.replace(new RegExp("("+this.query+")","ig"),function(a,b){return"<strong>"+b+"</strong>"});if(a.type==="subject")return b;if(a.type==="tag")return"<span class='searchtag'><span>"+b+"</span></span>"}});return $("#clearsearch").click(function(){s="";E(!0);return J()})};r=function(a,b,c){var d;a=$("script[name="+a+"]").html();d=Mustache.to_html(a,b);return $(c).html(d)};D=function(a,b){b==null&&(b=80);return $(a).each(function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,H,I,J,K,L,M,N,O;w=function(a){return a<10?"0"+a:a};E=new Date;E=""+E.getFullYear()+"/"+w(E.getMonth()+1)+"/"+w(E.getDate()+1);u=0;v=781200;$(this).find(".timeline-logic .timeline-point.today").attr("data-date",E);i=!1;$(this).find(".timeline-logic > ul > li").each(function(){var a,b,c,d,e,f,g,h,j,k,l,m,n,o,p;c=$(this).find(".timeline-point:first").attr("data-date");c=c.split(" ");c.length>1?m=c[1]:m="00:00:00";c=c[0].split("/");m=m.split(":");o=function(){var a,d,e;e=[];for(a=0,d=c.length;a<d;a++){b=c[a];e.push(parseInt(b,10))}return e}(),n=o[0],h=o[1],d=o[2];p=function(){var a,b,c;c=[];for(a=0,b=m.length;a<b;a++){l=m[a];c.push(parseInt(l,10))}return c}(),e=p[0],g=p[1],k=p[2];j=n*372+(h-1)*31+(d-1)+e/24+g/1440+k/86400;if(isNaN(j)||n===1970){j="xxx";i=!0}else{j>u&&(u=j);j<v&&(v=j-1)}$(this).attr("data-date-numeric",j);f=$(this).find("img");a=f!=null?f.attr("alt"):void 0;if(a)return f.attr("src","/profile/"+G(a))});if(i){u+=180;$(this).find(".timeline-logic > ul > li[data-date-numeric='xxx']").attr("data-date-numeric",u)}$(this).find(".timeline-logic > ul > li").tsort({attr:"data-date-numeric",order:"desc"});B=function(a){switch(a){case"NEW":return"טרם התחיל";case"STUCK":return"תקוע";case"IN_PROGRESS":return"בתהליך";case"FIXED":return"יושם במלואו";case"WORKAROUND":return"יושם חלקית";case"IRRELEVANT":return"יישום ההמלצה כבר לא נדרש"}};m=function(a){switch(a){case"NEW":return!1;case"STUCK":return!1;case"IN_PROGRESS":return!0;case"FIXED":return!0;case"WORKAROUND":return!1;case"IRRELEVANT":return!0}};h="NEW";p=0;n=5;j=$(this).innerHeight()-b;c=j;$(this).find(".timeline-logic > ul > li .timeline-point").each(function(){return c=c-$(this).outerHeight()-n});I=0;d=!1;e=null;s=!1;D=$(this).find(".timeline-logic > ul > li");if(D.length>0&&$(D[0]).find(".timeline-point").hasClass("today")){H=parseInt($(D[0]).attr("data-date-numeric"));q=parseInt($(this).find(".timeline-logic > ul > li").attr("data-date-numeric"));H-q>180&&(s=!0)}a=1e3;r=a;F=a;g=a;for(k=J=L=D.size()-1;L<=0?J<=0:J>=0;k=L<=0?++J:--J){f=$(D[k]);x=f.find(".timeline-point:first");t=f.find(".timeline-line:first");A=(M=x.attr("data-status"))!=null?M:h;if(x.hasClass("gov-update")){d=!1;h=A!=null?A:h;r=k}g===a&&(h==="FIXED"||h==="IRRELEVANT")&&(g=k);o=!1;if(x.hasClass("today")){F=k;o=!0}if(x.hasClass("watch-update")){if(m(h)!==m(A)){d=!0;e=A}x.addClass("watch-"+A);m(A)?x.addClass("watch-status-good"):x.addClass("watch-status-bad");r=k}if(F===a||o){x.find(".implementation-status").addClass("label-"+A);x.find(".implementation-status").html(B(A));t.addClass("status-"+h);d&&x.addClass("conflict");if(x.hasClass("gov-update")){x.addClass("gov-"+h);m(h)?x.addClass("gov-status-good"):x.addClass("gov-status-bad")}}}for(k=K=N=D.size()-1;N<=0?K<=0:K>=0;k=N<=0?++K:--K){f=$(D[k]);t=f.find(".timeline-line:first");if(g!==a&&k<=g||k<=F)t.addClass("future");else{t.addClass("past");k<=r&&t.addClass("unreported")}}$(this).find(".timeline-logic > ul > li").each(function(){var a,b,d,e;x=$(this).find(".timeline-point:first");t=$(this).find(".timeline-line:first");a=parseInt($(this).attr("data-date-numeric"));d=(u-a)/(u-v);e=x.outerHeight()+n;b=c*(d-p)+e;$(this).css("height",b);$(this).css("top",I);p=d;return I+=b});$(this).find(".timeline-logic > ul > li:first > .timeline-line").remove();l=(O=$(this).find(".gov-update:last").attr("data-status"))!=null?O:"NEW";if(d)$(this).find(".buxa-header").addClass("conflict");else{$(this).find(".buxa-header").removeClass("conflict");m(l)?$(this).find(".buxa-header").addClass("good"):$(this).find(".buxa-header").addClass("bad")}$(this).attr("data-implementation-status",l);$(this).addClass("implementation-status-"+l);C=function(a){switch(a){case"NEW":return"notstarted";case"STUCK":return"stuck";case"IN_PROGRESS":return"inprogress";case"FIXED":return"done";case"WORKAROUND":return"workaround";case"IRRELEVANT":return"done"}};z=C(l);s&&(z="late");$(this).find(".buxa-header").before("<div class='stamp "+z+"'></div>");if(d){y=B(e);z=C(e);return $(this).find(".buxa-header").before("<div class='stamp conflicting "+z+"'></div>")}})};B=function(){var a,b,c,d,e,f,g,i,j;i=$(".item.shown").size();g=$(".item.shown[data-implementation-status='STUCK']").size();f=$(".item.shown[data-implementation-status='NEW']").size();d=$(".item.shown[data-implementation-status='IN_PROGRESS']").size();b=$(".item.shown[data-implementation-status='FIXED']").size();j=$(".item.shown[data-implementation-status='WORKAROUND']").size();e=$(".item.shown[data-implementation-status='IRRELEVANT']").size();a={};i&&(a.total=i);g=f+j+g;g&&(a.stuck=g);c=b+e;c&&(a.implemented=c);d&&(a.in_progress=d);r("summary",a,"#summary");$("#summary .total").click(function(){H=null;h();return!1});$("#summary .stuck").click(function(){H=["STUCK","NEW","WORKAROUND"];h();return!1});$("#summary .implemented").click(function(){H=["FIXED","IRRELEVANT"];h();return!1});return $("#summary .in_progress").click(function(){H=["IN_PROGRESS"];h();return!1})};z=function(){$("#subscribe").modal({show:!1});$("#do_subscribe").click(function(){$("#subscribe_form").submit();return!1});return $("#subscribe_form").submit(function(){var a=this;$.post($(this).attr("action"),{email:$("#subscribe_email").val()},function(b){var c;$("#subscribe").modal("hide");c=$(a).attr("rel");return $(".watch[rel='"+c+"']").html(b)},"json");return!1})};A=function(a){return $(""+a+" .watch").click(function(){var a;a=$(this).attr("rel");$("#subscribe_email").attr("data-slug",a);$("#subscribe_form").attr("action","/subscribe/"+a);$("#subscribe_form").attr("rel",a);$("#subscribe").modal("show");return!1})};C=function(a){return $(a).click(function(){s=$(this).text();E(!1);$("#searchbox").val(s);$("#explanation").modal("hide");J();return!1})};x=function(){return $(".item .goto-detail").click(function(){var a,b,c,d,e;b=$(this).attr("rel");if(!b){e=$(this).parents();for(c=0,d=e.length;c<d;c++){a=e[c];b=$(a).attr("rel");if(b)break}}J(b);return!1})};q=function(){var a,b,c,e,f,g,h,i=this;f=L;c=k.findDeferral(arguments);if(l)return;l=!0;for(g=0,h=d.length;g<h;g++){a=d[g];$("#books").prepend("<li data-book='"+a+"' class='book'><a href='#'>"+a+"</a></li>")}r("item",{items:o},"#items");b=!0;(typeof localStorage!=="undefined"&&localStorage!==null?localStorage.explained:void 0)!=null&&(b=!1);$("#explanation .close").click(function(){typeof localStorage!="undefined"&&localStorage!==null&&(localStorage.explained=!0);$("#explanation").modal("hide");return!1});$("#show-explanation").click(function(){$("#explanation").modal("show");return!1});(function(a){e=new k.Deferrals(a,{parent:c,filename:"gov-watch.iced",funcname:"process_data"});setTimeout(e.defer({assign_fn:function(){return function(){return e.ret=arguments[0]}}(),lineno:556}),50);e._fulfill()})(function(){$.Isotope.prototype._positionAbs=function(a,b){return{right:a,top:b}};$("#items").isotope({itemSelector:".isotope-card",layoutMode:"masonry",transformsEnabled:!1,filter:".shown",getSortData:{followers:function(a){return-parseInt("0"+a.find(".watch").text())},original:function(a){return""+a.attr("data-chapter")+"/{e.attr('data-subchapter')}"},budget:function(a){return-parseInt("0"+a.attr("cost"),10)},comments:function(a){var b;b=-parseInt("0"+a.find(".commentcount").text(),10);return b}}});(function(a){e=new k.Deferrals(a,{parent:c,filename:"gov-watch.iced",funcname:"process_data"});setTimeout(e.defer({assign_fn:function(){return function(){return e.ret=arguments[0]}}(),lineno:578}),50);e._fulfill()})(function(){D(".item");$(".item").css("visibility","inherit");y();z();A(".item");C(".item .tags > ul > li, a[data-tag='true']");x();$("#books li.book a").click(function(){u=$(this).html();return J()});$("#sort button").click(function(){var a;$("#sort button").removeClass("active");$(this).addClass("active");a=$(this).attr("value");$("#items").isotope("updateSortData",$(".isotope-card"));return $("#items").isotope({sortBy:a})});$("#explanation").modal({show:b});window.onhashchange=p;p();return n(".item")})})};t=function(a){var b,c,d,e,f,g,h,i,l=this;g=L;e=k.findDeferral(arguments);$("fb\\:comments").remove();$("fb\\:like").remove();if(!a){$("#single-item").html("");$("#summary-header").css("visibility","inherit");$("#sort button").removeClass("disabled");$("#searchbox").removeClass("disabled");$("#searchbox").attr("disabled",null);$("#clearsearch").removeClass("disabled");return g($("#clearsearch").attr("disabled",null))}$("#summary-header").css("visibility","hidden");$("#summary").html("");$("#sort button").addClass("disabled");$("#searchbox").addClass("disabled");$("#searchbox").attr("disabled","disabled");$("#clearsearch").addClass("disabled");$("#clearsearch").attr("disabled","disabled");for(h=0,i=o.length;h<i;h++){d=o[h];if(d.slug===a){b=r("single-item",d,"#single-item");w(d.base.book+": "+d.base.subject);c=j(a);$(".detail-view .fb").append("<fb:like href='"+c+"' send='true' width='700' show_faces='true' action='recommend' font='tahoma'></fb:like>");$(".detail-view .fb").append("<fb:comments href='"+c+"' num_posts='2' width='700'></fb:comments>");window.FB&&FB.XFBML.parse(b.get(0),function(){});break}}(function(a){f=new k.Deferrals(a,{parent:e,filename:"gov-watch.iced",funcname:"select_item"});setTimeout(f.defer({assign_fn:function(){return function(){return f.ret=arguments[0]}}(),lineno:641}),50);f._fulfill()})(function(){D(".detail-view",0);A(".detail-view");C(".detail-view .tags > ul > li");return g(n(".detail-view"))})};n=function(a){$(""+a+" .commentcount").each(function(){var a,b,c,d,e,f,g=this;f=L;d=k.findDeferral(arguments);c=$(this).attr("rel");(function(a){e=new k.Deferrals(a,{parent:d,filename:"gov-watch.iced"});$.get("https://api.facebook.com/method/fql.query",{query:"SELECT url,commentsbox_count FROM link_stat WHERE url='"+j(c)+"'",format:"json"},e.defer({assign_fn:function(){return function(){return b=arguments[0]}}(),lineno:667}),"json");e._fulfill()})(function(){a=$(g).html();return $(g).html(b[0].commentsbox_count+a)})});if(a===".item")return $("#items").isotope("updateSortData",$(".item"))};h=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,p,q,r;c=RegExp(s,"ig");for(j=0,m=o.length;j<m;j++){d=o[j];f=d.slug;d=d.base;e=s==="";if(s!==""){q=[d.recommendation,d.subject,d.result_metric,d.title,d.chapter,d.subchapter,d.responsible_authority.main,d.responsible_authority.secondary];for(k=0,n=q.length;k<n;k++){i=q[k];i?b=i.indexOf(s)>=0:b=!1;e=e||b}r=d.tags;for(l=0,p=r.length;l<p;l++){h=r[l];h===s&&(e=!0)}}e=e&&(u===""||d.book===u)&&!v;$(".item[rel="+f+"]").toggleClass("shown",e)}B();if(H){a=[function(){var a,b,c;c=[];for(a=0,b=H.length;a<b;a++){g=H[a];c.push(".shown.implementation-status-"+g)}return c}()];a=a.join(",")}else a=".shown";a+=",.always-shown";$("#items").isotope({filter:a});return $("#items").isotope("reLayout")};m=function(){return $.get("/api",g,"json")};$(function(){var a,b,c,g,h,i=this;h=L;c=k.findDeferral(arguments);try{(function(a){g=new k.Deferrals(a,{parent:c,filename:"gov-watch.iced"});$.get("/api/version",g.defer({assign_fn:function(){return function(){return b=arguments[0]}}(),lineno:728}),"json");g._fulfill()})(function(){a=localStorage.version;localStorage.version=JSON.stringify(b);if(a&&b!==JSON.parse(a)){o=JSON.parse(localStorage.data);d=JSON.parse(localStorage.all_books);f=JSON.parse(localStorage.all_tags);e=JSON.parse(localStorage.all_subjects);return q()}return m()})}catch(j){return m()}})}).call(this);